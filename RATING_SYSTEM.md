# 🏆 Система рейтинга OTA-Sematary

## Новые функции

### ✅ Множественные способы входа
- **Google OAuth** - вход одним кликом
- **Email (Magic Link)** - вход без пароля
- **Анонимный режим** - играть без регистрации
- Безопасная аутентификация через Supabase
- Сессии автоматически сохраняются

### ✅ Система рейтинга
- Автоматическое сохранение результатов при завершении игры
- ТОП-10 лучших игроков
- Медали для первых трёх мест (🥇🥈🥉)
- Подсветка текущего пользователя

### ✅ Новый UI Flow

**1. Экран входа** (если не авторизован)
```
┌─────────────────────────────┐
│   🎮 OTA-SEMATARY           │
│   Войдите для рейтинга      │
│                             │
│   [🔐 Войти через Google]   │
│                             │
│        или                  │
│                             │
│   [Email input]             │
│   [📧 Войти через Email]    │
│                             │
│        или                  │
│                             │
│   [👤 Играть без рег-ции]   │
│   ⚠️ Без сохранения         │
└─────────────────────────────┘
```

**2. Главное меню** (после входа)
```
┌──────────────────────────────┐
│   🎮 OTA-SEMATARY            │
│   Вы вошли как: user@mail.ru │
│                              │
│   [🚀 Начать игру]           │
│   [🏆 Показать рейтинг]      │
│   [🚪 Выйти]                 │
└──────────────────────────────┘

Или (анонимный режим):
┌──────────────────────────────┐
│   🎮 OTA-SEMATARY            │
│   👤 Анонимный режим         │
│   Результат не сохранится    │
│                              │
│   [🚀 Начать игру]           │
│   [🏠 Вернуться к входу]     │
└──────────────────────────────┘
```

**3. Рейтинг**
```
┌─────────────────────────┐
│   🏆 ТОП-10 Игроков     │
│                         │
│   🥇 us***@mail.ru 01:23│
│   🥈 jo***@mail.ru 01:45│
│   🥉 al***@mail.ru 02:10│
│   #4 bo***@mail.ru 02:34│
│   ...                   │
└─────────────────────────┘
```

## Технические детали

### Компоненты

- **`Auth.jsx`** - Форма входа через email
- **`Leaderboard.jsx`** - Отображение рейтинга
- **`supabaseClient.js`** - Конфигурация клиента Supabase

### Логика работы

1. **Проверка сессии** при загрузке приложения
2. **Условный рендеринг**:
   - Нет сессии → Показываем `Auth`
   - Есть сессия, игра не начата → Показываем меню
   - Есть сессия, игра начата → Показываем игру
3. **Сохранение результата**:
   - При `gameComplete = true`
   - Автоматически отправляется в Supabase
   - Данные: `email`, `time`, `created_at`
   - **НЕ сохраняется** в анонимном режиме

### База данных

**Таблица: `leaderboard`**
- `id` (UUID) - Primary Key
- `email` (TEXT) - Email игрока
- `time` (INTEGER) - Время в секундах
- `created_at` (TIMESTAMP) - Дата создания

**Политики безопасности:**
- Все могут читать (`SELECT`)
- Только аутентифицированные могут писать (`INSERT`)

### Приватность

Email маскируется в рейтинге:
- `user@example.com` → `us***@example.com`
- Показываются только первые 2 символа

## Установка

1. Установите зависимости:
```bash
npm install @supabase/supabase-js
```

2. Настройте Supabase (см. `SUPABASE_SETUP.md`)

3. Создайте `.env`:
```env
VITE_SUPABASE_URL=your_url
VITE_SUPABASE_ANON_KEY=your_key
```

4. Запустите проект:
```bash
npm run dev
```

## Будущие улучшения

- [ ] Добавить фильтры рейтинга (по дате, всё время)
- [ ] Показывать позицию игрока в общем рейтинге
- [ ] Добавить статистику (попытки, средний результат)
- [ ] Реализовать профиль пользователя
- [ ] Добавить аватары через Gravatar
- [ ] Сделать пагинацию рейтинга
- [ ] Добавить графики прогресса

## API Reference

### `supabase.auth.signInWithOtp()`
Отправляет magic link на email

### `supabase.auth.getSession()`
Получает текущую сессию

### `supabase.auth.signOut()`
Выход из системы

### `supabase.from('leaderboard').select()`
Получение данных рейтинга

### `supabase.from('leaderboard').insert()`
Сохранение результата

